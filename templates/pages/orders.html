{{ define "orders" }}
<section class="orders-page py-5">
    <div class="container">

        <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-4">
            <div>
                <h1 class="orders-title mb-1">Pesanan Saya</h1>
                <p class="orders-subtitle mb-0">
                    Lihat riwayat pesanan fashion kamu dan pantau status pengirimannya.
                </p>
            </div>
            <div class="mt-3 mt-md-0">
                <div class="orders-count-pill">
                    <span class="me-1">Total pesanan:</span>
                    <strong>{{ .totalOrders }}</strong>
                </div>
            </div>
        </div>

        {{ if .success }}
        <div class="alert alert-success pastel-auth-alert mb-3">
            {{ index .success 0 }}
        </div>
        {{ end }}

        {{ if .error }}
        <div class="alert alert-danger pastel-auth-alert mb-3">
            {{ index .error 0 }}
        </div>
        {{ end }}

        <!-- FILTERS -->
        <form method="GET" action="/orders" class="pastel-card orders-filter-card mb-4">
            <div class="form-row">
                <div class="form-group col-md-3 mb-3">
                    <label class="orders-label">Status Pesanan</label>
                    <select class="form-control form-control-sm auth-input" name="status">
                        <option value="all" {{ if or (eq .statusFilter "" ) (eq .statusFilter "all" ) }}selected{{ end
                            }}>
                            Semua
                        </option>
                        <option value="pending" {{ if eq .statusFilter "pending" }}selected{{ end }}>Pending</option>
                        <option value="processing" {{ if eq .statusFilter "processing" }}selected{{ end }}>Diproses
                        </option>
                        <option value="shipped" {{ if eq .statusFilter "shipped" }}selected{{ end }}>Dikirim</option>
                        <option value="completed" {{ if eq .statusFilter "completed" }}selected{{ end }}>Selesai
                        </option>
                    </select>
                </div>

                <div class="form-group col-md-3 mb-3">
                    <label class="orders-label">Status Pembayaran</label>
                    <select class="form-control form-control-sm auth-input" name="payment">
                        <option value="all" {{ if or (eq .paymentFilter "" ) (eq .paymentFilter "all" ) }}selected{{ end
                            }}>
                            Semua
                        </option>
                        <option value="unpaid" {{ if eq .paymentFilter "unpaid" }}selected{{ end }}>Belum Dibayar
                        </option>
                        <option value="waiting_review" {{ if eq .paymentFilter "waiting_review" }}selected{{ end }}>
                            Menunggu Review
                        </option>
                        <option value="paid" {{ if eq .paymentFilter "paid" }}selected{{ end }}>Lunas</option>
                    </select>
                </div>

                <div class="form-group col-md-2 mb-3">
                    <label class="orders-label">Dari Tanggal</label>
                    <input type="date" class="form-control form-control-sm auth-input" name="date_from"
                        value="{{ .dateFrom }}">
                </div>

                <div class="form-group col-md-2 mb-3">
                    <label class="orders-label">Sampai Tanggal</label>
                    <input type="date" class="form-control form-control-sm auth-input" name="date_to"
                        value="{{ .dateTo }}">
                </div>

                <div class="form-group col-md-2 mb-0 d-flex align-items-end">
                    <button type="submit" class="btn-auth-primary w-100">
                        Terapkan
                    </button>
                </div>
            </div>
        </form>

        <!-- TABEL PESANAN -->
        <div class="pastel-card">
            <div class="table-responsive">
                <table class="table mb-0 orders-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Kode</th>
                            <th>Tanggal</th>
                            <th>Total</th>
                            <th>Status</th>
                            <th>Payment</th>
                            <th class="text-right">Aksi</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{ if .orders }}
                        {{ range $i, $o := .orders }}
                        <tr>
                            <td>{{ add $i 1 }}</td>
                            <td>{{ $o.Code }}</td>
                            <td>{{ $o.CreatedAt.Format "02 Jan 2006 15:04" }}</td>
                            <td>{{ formatRupiah $o.GrandTotalFloat }}</td>
                            <td>
                                {{/* badge status pakai StatusText biar aman walau di DB integer */}}
                                {{ $label := $o.StatusText }}
                                {{ $s := lower $label }}

                                {{ if or (eq $s "pending") (eq $s "diproses") }}
                                <span class="status-pill status-pill-pending">{{ $label }}</span>
                                {{ else if or (eq $s "processing") (eq $s "dikirim") (eq $s "shipped") }}
                                <span class="status-pill status-pill-progress">{{ $label }}</span>
                                {{ else if or (eq $s "completed") (eq $s "selesai") (eq $s "delivered") }}
                                <span class="status-pill status-pill-done">{{ $label }}</span>
                                {{ else }}
                                <span class="status-pill status-pill-neutral">{{ $label }}</span>
                                {{ end }}
                            </td>

                            <td>
                                {{ if $o.IsPaid }}
                                <span class="status-pill status-pill-paid">Paid</span>
                                {{ else if eq (lower $o.PaymentStatus) "waiting_review" }}
                                <span class="status-pill status-pill-review">Waiting Review</span>
                                {{ else if eq (lower $o.PaymentStatus) "rejected" }}
                                <span class="status-pill status-pill-reject">Rejected</span>
                                {{ else }}
                                <span class="status-pill status-pill-unpaid">Unpaid</span>
                                {{ end }}
                            </td>

                            <td class="text-right">
                                <a href="/orders/{{ $o.ID }}" class="btn-order-detail">
                                    Detail
                                </a>
                            </td>
                        </tr>
                        {{ end }}
                        {{ else }}
                        <tr>
                            <td colspan="7" class="text-center text-muted py-4">
                                Belum ada pesanan.
                            </td>
                        </tr>
                        {{ end }}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- PAGINATION -->
        <nav aria-label="Page navigation" class="mt-4">
            <ul class="pagination justify-content-center mb-0">
                {{ $page := .currentPage }}
                {{ $total := .totalPages }}

                {{ if gt $page 1 }}
                <li class="page-item">
                    <a class="page-link" href="/orders?{{ urlValuesWithPage .query (sub $page 1) }}">«</a>
                </li>
                {{ else }}
                <li class="page-item disabled"><span class="page-link">«</span></li>
                {{ end }}

                {{ range $i := seq 1 $total }}
                <li class="page-item {{ if eq $i $page }}active{{ end }}">
                    <a class="page-link" href="/orders?{{ urlValuesWithPage $.query $i }}">{{ $i }}</a>
                </li>
                {{ end }}

                {{ if lt $page $total }}
                <li class="page-item">
                    <a class="page-link" href="/orders?{{ urlValuesWithPage .query (add $page 1) }}">»</a>
                </li>
                {{ else }}
                <li class="page-item disabled"><span class="page-link">»</span></li>
                {{ end }}
            </ul>
        </nav>

    </div>
</section>

<style>
    .orders-page {
        background: var(--pastel-bg);
    }

    .orders-title {
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--text-main);
    }

    .orders-subtitle {
        font-size: 0.9rem;
        color: var(--text-muted);
    }

    .orders-count-pill {
        padding: 8px 18px;
        border-radius: 999px;
        background: var(--pastel-card);
        border: 1px solid var(--pastel-border);
        font-size: 0.9rem;
        box-shadow: 0 10px 18px rgba(15, 23, 42, 0.08);
    }

    .pastel-card {
        background: var(--pastel-card);
        border-radius: 18px;
        border: 1px solid var(--pastel-border);
        box-shadow: 0 18px 35px rgba(15, 23, 42, 0.05);
        padding: 18px 18px 20px;
    }

    .orders-filter-card {
        padding-top: 16px;
        padding-bottom: 12px;
    }

    .orders-label {
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--text-muted);
        margin-bottom: 4px;
    }

    .auth-input {
        border-radius: 999px;
        border-color: var(--pastel-border);
        font-size: 0.9rem;
    }

    .auth-input:focus {
        border-color: var(--pastel-accent);
        box-shadow: 0 0 0 0.15rem rgba(129, 140, 248, 0.25);
    }

    .btn-auth-primary {
        border-radius: 999px;
        padding: 8px 16px;
        border: none;
        background: var(--pastel-accent);
        color: #ffffff;
        font-size: 0.85rem;
        font-weight: 600;
        letter-spacing: 0.06em;
        text-transform: uppercase;
        box-shadow: 0 10px 20px rgba(129, 140, 248, 0.5);
    }

    .btn-auth-primary:hover {
        background: #7c3aed;
        box-shadow: 0 14px 26px rgba(79, 70, 229, 0.6);
    }

    .orders-table thead th {
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--text-muted);
        border-bottom: 1px solid var(--pastel-border);
        border-top: none;
        background: #f4f3ff;
    }

    .orders-table tbody td {
        font-size: 0.9rem;
        vertical-align: middle;
        border-top: 1px solid var(--pastel-border);
    }

    .status-pill {
        display: inline-flex;
        align-items: center;
        padding: 3px 9px;
        border-radius: 999px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.06em;
        border: 1px solid transparent;
    }

    .status-pill-pending {
        background: #fef9c3;
        color: #854d0e;
        border-color: #facc15;
    }

    .status-pill-progress {
        background: #e0f2fe;
        color: #075985;
        border-color: #38bdf8;
    }

    .status-pill-done {
        background: #dcfce7;
        color: #166534;
        border-color: #22c55e;
    }

    .status-pill-neutral {
        background: #e5e7eb;
        color: #374151;
        border-color: #d1d5db;
    }

    .status-pill-paid {
        background: #dcfce7;
        color: #15803d;
        border-color: #22c55e;
    }

    .status-pill-review {
        background: #f5f3ff;
        color: #5b21b6;
        border-color: #a855f7;
    }

    .status-pill-reject {
        background: #fee2e2;
        color: #b91c1c;
        border-color: #f97373;
    }

    .status-pill-unpaid {
        background: #fef2f2;
        color: #b91c1c;
        border-color: #fecaca;
    }

    .btn-order-detail {
        border-radius: 999px;
        padding: 6px 14px;
        font-size: 0.8rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.06em;
        border: none;
        background: var(--pastel-accent-soft);
        color: var(--pastel-accent);
        text-decoration: none;
    }

    .btn-order-detail:hover {
        background: var(--pastel-accent);
        color: #ffffff;
    }

    .pastel-auth-alert {
        border-radius: 999px;
        padding: 8px 14px;
        font-size: 0.8rem;
    }

    @media (max-width: 767.98px) {
        .orders-title {
            font-size: 1.5rem;
        }

        .pastel-card {
            padding: 14px 14px 16px;
        }
    }
</style>
{{ end }}